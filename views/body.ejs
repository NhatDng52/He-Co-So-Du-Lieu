<!-- Render dữ liệu từ backend -->
<% phim.forEach(phim => { %>
    <div class="phim">
        <div class="phim-poster">
            <img src="<%= phim.Link_poster %>" alt="<%= phim.Ten_phim %>" class="poster" onclick="toggleShowtimes('<%= phim.Ma_phim %>')">
        </div>
        <div class="phim-details">
            <h2><%= phim.Ten_phim %></h2>
            <p><strong>Độ tuổi:</strong> <%= phim.Do_tuoi %></p>
            <p><strong>Năm sản xuất:</strong> <%= phim.Nam_san_xuat %></p>
            <p><strong>Rating:</strong> <%= phim.Rating %></p>
            <p><strong>Thời lượng:</strong> <%= phim.Thoi_luong %> phút</p>
            <p><strong>Mô tả:</strong> <%= phim.Mo_ta %></p>
            <p><strong>Nhân phim:</strong> <%= phim.Nhan_phim %></p>
        </div>
        <div class="showtimes" id="showtimes-<%= phim.Ma_phim %>">
            <h2>Showtimes for <%= phim.Ten_phim %></h2>
            <% const groupedShowtimes = suat_chieu.filter(suat => suat.Ma_phim === phim.Ma_phim)
                .reduce((acc, suat) => {
                    (acc[suat.Ngay_thang] = acc[suat.Ngay_thang] || []).push(suat);
                    return acc;
                }, {}); 
            %>
            <% Object.keys(groupedShowtimes).forEach(ngay_thang => { %>
                <div class="showtime-date">
                    <strong><%= ngay_thang %></strong>
                </div>
                <div class="showtime-times">
                    <% groupedShowtimes[ngay_thang].forEach(suat => { %>
                        <span onclick="showBranchesForShowtime('<%= suat.Ma_suat_chieu %>')">
                            <%= suat.Gio %>
                        </span>
                        <div class="available-branches" id="branches-<%= suat.Ma_suat_chieu %>">
                            <h3>Chi Nhánh Có Sẵn</h3>
                            <% const branches = chi_nhanh.filter(cn => cn.Ma_chi_nhanh === suat.Ma_chi_nhanh); 
                                branches.forEach(branch => { 
                            %>
                                <p>
                                    <%= branch.Dia_chi_phu %>
                                    <button onclick="selectBranch('<%= suat.Ma_suat_chieu %>', '<%= branch.Ma_chi_nhanh %>')">Chọn</button>
                                </p>
                            <% }); %>
                        </div>
                        <div class="tickets" id="tickets-<%= suat.Ma_suat_chieu %>"></div>
                    <% }); %>
                </div>
            <% }); %>
        </div>
    </div>
<% }); %>

<div class="payment-section" id="payment-section">
    <h4>Tổng tiền: <span id="total-price">0</span> VND</h4>
    <button onclick="completePayment()">Thanh Toán</button>
</div>