<!-- Render dữ liệu từ backend -->
<% phim.forEach(phim => { %>
    <div class="phim">
        <div class="phim-poster">
            <img src="<%= phim.link_poster %>" alt="<%= phim.ten_phim %>" class="poster" onclick="toggleShowtimes('<%= phim.ma_phim %>')">
        </div>
        <div class="phim-details">
            <h2><%= phim.ten_phim %></h2>
            <p><strong>Độ tuổi:</strong> <%= phim.do_tuoi %></p>
            <p><strong>Năm sản xuất:</strong> <%= phim.nam_san_xuat %></p>
            <p><strong>Rating:</strong> <%= phim.rating %></p>
            <p><strong>Thời lượng:</strong> <%= phim.thoi_luong %> phút</p>
            <p><strong>Mô tả:</strong> <%= phim.mo_ta %></p>
            <p><strong>Nhân phim:</strong> <%= phim.nhan_phim %></p>
        </div>
        <div class="showtimes" id="showtimes-<%= phim.ma_phim %>">
            <h2>Showtimes for <%= phim.ten_phim %></h2>
            <% const groupedShowtimes = suat_chieu.filter(suat => suat.ma_phim === phim.ma_phim)
                .reduce((acc, suat) => {
                    (acc[suat.ngay_thang] = acc[suat.ngay_thang] || []).push(suat);
                    return acc;
                }, {}); 
            %>
            <% Object.keys(groupedShowtimes).forEach(ngay_thang => { %>
                <div class="showtime-date">
                    <strong><%= ngay_thang %></strong>
                </div>
                <div class="showtime-times">
                    <% groupedShowtimes[ngay_thang].forEach(suat => { %>
                        <span onclick="showBranchesForShowtime('<%= suat.ma_suat_chieu %>')">
                            <%= suat.gio %>
                        </span>
                        <div class="available-branches" id="branches-<%= suat.ma_suat_chieu %>">
                            <h3>Chi Nhánh Có Sẵn</h3>
                            <% const branches = chi_nhanh.filter(cn => cn.ma_chi_nhanh === suat.ma_chi_nhanh); 
                                branches.forEach(branch => { 
                            %>
                                <p>
                                    <%= branch.dia_chi_phu %>
                                    <button onclick="selectBranch('<%= suat.ma_suat_chieu %>', '<%= branch.ma_chi_nhanh %>')">Chọn</button>
                                </p>
                            <% }); %>
                        </div>
                        <div class="tickets" id="tickets-<%= suat.ma_suat_chieu %>"></div>
                    <% }); %>
                </div>
            <% }); %>
        </div>
    </div>
<% }); %>

<div class="payment-section" id="payment-section">
    <h4>Tổng tiền: <span id="total-price">0</span> VND</h4>
    <button onclick="completePayment()">Thanh Toán</button>
</div>